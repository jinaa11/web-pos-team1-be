<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ko"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SettlementMonthService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">webpos</a> &gt; <a href="index.source.html" class="el_package">com.ssg.webpos.service</a> &gt; <span class="el_source">SettlementMonthService.java</span></div><h1>SettlementMonthService.java</h1><pre class="source lang-java linenums">package com.ssg.webpos.service;

import com.ssg.webpos.domain.SettlementMonth;
import com.ssg.webpos.dto.settlement.SettlementMonthReportDTO;
import com.ssg.webpos.repository.settlement.SettlementMonthRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import javax.transaction.Transactional;
import java.time.*;
import java.time.format.DateTimeFormatter;
import java.time.format.DateTimeParseException;
import java.util.Collections;
import java.util.List;


@Service
<span class="nc" id="L18">@RequiredArgsConstructor</span>
@Transactional
public class SettlementMonthService {
    private final SettlementMonthRepository settlementMonthRepository;

    //store_id별 조회(HQ 활용)
    public List&lt;SettlementMonth&gt; selectByStoreId(Long storeId) throws IllegalStateException {
        try {
<span class="nc" id="L26">            List&lt;SettlementMonth&gt; list = settlementMonthRepository.findByStoreId(storeId);</span>
<span class="nc" id="L27">            return list;</span>
<span class="nc" id="L28">        } catch (Exception e) {</span>
<span class="nc" id="L29">            e.printStackTrace();</span>
<span class="nc" id="L30">            return Collections.emptyList();</span>
        }
    }
    //월별 조회(HQ 활용)
    public List&lt;SettlementMonth&gt; selectByDay(String settlementDate) throws DateTimeParseException {
       try{
<span class="nc" id="L36">            LocalDate localDate = LocalDate.parse(settlementDate);</span>
<span class="nc" id="L37">            List&lt;SettlementMonth&gt; list = settlementMonthRepository.findBySettlementDate(localDate);</span>
<span class="nc" id="L38">            return list;</span>
<span class="nc" id="L39">       } catch (Exception e) {</span>
<span class="nc" id="L40">           e.printStackTrace();</span>
<span class="nc" id="L41">           System.out.println(e);</span>
<span class="nc" id="L42">           return Collections.emptyList();</span>
       }
    }
    //store_id별,월별 조회(점장 활용)
    public List&lt;SettlementMonth&gt; selectByStoreIdAndDay(Long storeId, String settlementDate) throws DateTimeParseException {
        try {
<span class="nc" id="L48">            LocalDate SettlementDate = LocalDate.parse(settlementDate);</span>
<span class="nc" id="L49">            List&lt;SettlementMonth&gt; list = settlementMonthRepository.findByStoreIdAndSettlementDate(1L,SettlementDate);</span>
<span class="nc" id="L50">            return list;</span>
<span class="nc" id="L51">        } catch (Exception e) {</span>
<span class="nc" id="L52">            e.printStackTrace();</span>
<span class="nc" id="L53">            System.out.println(e);</span>
<span class="nc" id="L54">            return Collections.emptyList();</span>
        }
    }

    // store_id, year 별 월별정산내역 조회
    // 1L, &quot;2023&quot; 받을시 store_id=1L인 가게의 2023년 월별정산내역 조회
    public List&lt;SettlementMonth&gt; selectByStoreIdAndDayBetween(Long storeId, String year) throws DateTimeParseException {
        try {
<span class="nc" id="L62">            LocalDate StartDate = LocalDate.of(Integer.parseInt(year), Month.JANUARY,1);</span>
<span class="nc" id="L63">            LocalDate EndDate = LocalDate.of(Integer.parseInt(year), Month.DECEMBER,31);</span>
<span class="nc" id="L64">            List&lt;SettlementMonth&gt; list = settlementMonthRepository.findByStoreIdAndSettlementDateBetween(storeId,StartDate,EndDate);</span>
<span class="nc" id="L65">            return list;</span>
<span class="nc" id="L66">        } catch (Exception e) {</span>
<span class="nc" id="L67">            e.printStackTrace();</span>
<span class="nc" id="L68">            System.out.println(e);</span>
<span class="nc" id="L69">            return Collections.emptyList();</span>
        }
    }

    // year 받으면 해당 월별정산내역 조회
    // SettlementMonth(id=132, settlementPrice=500000000, settlementDate=2023-11-01) 가 불러와진다.
    public List&lt;SettlementMonth&gt; selectByYear(String year) {
        try {
<span class="nc" id="L77">            LocalDate StartDate = LocalDate.of(Integer.parseInt(year), Month.JANUARY,1);</span>
<span class="nc" id="L78">            LocalDate EndDate = LocalDate.of(Integer.parseInt(year), Month.DECEMBER,31);</span>
<span class="nc" id="L79">            List&lt;SettlementMonth&gt; list = settlementMonthRepository.findBySettlementDateBetween(StartDate,EndDate);</span>
<span class="nc" id="L80">            return list;</span>
<span class="nc" id="L81">        } catch (Exception e) {</span>
<span class="nc" id="L82">            e.printStackTrace();</span>
<span class="nc" id="L83">            System.out.println(e);</span>
<span class="nc" id="L84">            return Collections.emptyList();</span>
        }
    }

    // 기간별 전체 월별정산내역 조회
    // &quot;yyyy-mm&quot; 을 받아온다.
    // ex. &quot;2023-02&quot;,&quot;2023-03&quot; 받으면 2023-02부터 2023-03까지의 월별정산내역 조회
    public List&lt;SettlementMonth&gt; selectByMonthRange(String startDate, String endDate) {
        try {
<span class="nc" id="L93">            LocalDate start = LocalDate.parse(startDate + &quot;-01&quot;, DateTimeFormatter.ISO_LOCAL_DATE);</span>
<span class="nc" id="L94">            LocalDate end = LocalDate.parse(endDate + &quot;-01&quot;, DateTimeFormatter.ISO_LOCAL_DATE);</span>
<span class="nc" id="L95">            List&lt;SettlementMonth&gt; list = settlementMonthRepository.findBySettlementDateBetween(start,end);</span>
<span class="nc" id="L96">            return list;</span>
<span class="nc" id="L97">        } catch (Exception e) {</span>
<span class="nc" id="L98">            e.printStackTrace();</span>
<span class="nc" id="L99">            System.out.println(e);</span>
<span class="nc" id="L100">            return Collections.emptyList();</span>
        }
    }

    // 기간별 store_id별 월별정산내역 조회
    public List&lt;SettlementMonth&gt; selectByStoreIdAndMonthRange(Long storeId, String startDate, String endDate) throws DateTimeParseException {
        try {
<span class="nc" id="L107">            LocalDate start = LocalDate.parse(startDate + &quot;-01&quot;, DateTimeFormatter.ISO_LOCAL_DATE);</span>
<span class="nc" id="L108">            LocalDate end = LocalDate.parse(endDate + &quot;-01&quot;, DateTimeFormatter.ISO_LOCAL_DATE);</span>
<span class="nc" id="L109">            List&lt;SettlementMonth&gt; list = settlementMonthRepository.findByStoreIdAndSettlementDateBetween(storeId,start,end);</span>
<span class="nc" id="L110">            return list;</span>
<span class="nc" id="L111">        } catch (Exception e) {</span>
<span class="nc" id="L112">            e.printStackTrace();</span>
<span class="nc" id="L113">            System.out.println(e);</span>
<span class="nc" id="L114">            return Collections.emptyList();</span>
        }
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>